{% extends 'books/base.html' %}

{% block title %}Methodology - EmoArc{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-6">How It Works</h1>
    <p class="text-xl text-gray-600 mb-12">Understanding emotional analysis in literature</p>

    <!-- Overview -->
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-8 mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Overview</h2>
        <p class="text-lg text-gray-700 leading-relaxed">
            EmoArc analyzes the emotional content of books using <strong>computational text analysis</strong>.
            We map words to emotions using validated psychological lexicons, then track how these emotions
            change throughout the narrative to reveal patterns and insights.
        </p>
    </div>

    <!-- Step by Step -->
    <div class="space-y-8 mb-12">
        <h2 class="text-3xl font-bold text-gray-900">The Analysis Process</h2>

        <!-- Step 1 -->
        <div class="border-l-4 border-purple-500 pl-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">1. Text Preprocessing</h3>
            <p class="text-gray-700 mb-3">
                Each book is divided into <strong>20 equal chunks</strong> (percentage-based, not word count).
                This ensures books of different lengths can be compared fairly.
            </p>
            <ul class="list-disc list-inside text-gray-600 space-y-1">
                <li>Remove Project Gutenberg headers/footers</li>
                <li>Tokenize text into individual words</li>
                <li>Remove stopwords (common words like "the", "and")</li>
                <li>Normalize to lowercase</li>
            </ul>
        </div>

        <!-- Step 2 -->
        <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">2. Emotion Scoring</h3>
            <p class="text-gray-700 mb-3">
                We use the <strong>NRC Emotion Lexicon</strong>, a research-validated dictionary mapping
                14,000+ words to Plutchik's 8 basic emotions.
            </p>

            <div class="bg-gray-50 rounded-lg p-4 mb-3">
                <h4 class="font-semibold text-gray-900 mb-2">Plutchik's 8 Basic Emotions:</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded text-sm">Joy</span>
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm">Sadness</span>
                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded text-sm">Fear</span>
                    <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded text-sm">Anger</span>
                    <span class="px-3 py-1 bg-pink-100 text-pink-800 rounded text-sm">Surprise</span>
                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded text-sm">Trust</span>
                    <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded text-sm">Disgust</span>
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-800 rounded text-sm">Anticipation</span>
                </div>
            </div>

            <p class="text-gray-700">
                <strong>How scoring works:</strong> For each chunk, we count how many words match each emotion
                in the lexicon. The raw count is then averaged across all chunks to get the book's overall score.
            </p>

            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-4">
                <p class="text-sm text-yellow-800">
                    <strong>⚠️ Important:</strong> Scores represent <em>relative frequency</em> of emotion words,
                    not absolute intensity. A score of 0.234 means roughly 23.4 emotion words per 100 words of text.
                </p>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">3. VAD Dimensions</h3>
            <p class="text-gray-700 mb-3">
                The <strong>NRC VAD Lexicon</strong> provides scores for 20,000+ words across three dimensions:
            </p>
            <ul class="space-y-2">
                <li>
                    <strong class="text-green-600">Valence:</strong>
                    <span class="text-gray-700">Positive (happy, good) vs. Negative (sad, bad)</span>
                </li>
                <li>
                    <strong class="text-amber-600">Arousal:</strong>
                    <span class="text-gray-700">Intense (excited, tense) vs. Calm (relaxed, quiet)</span>
                </li>
                <li>
                    <strong class="text-purple-600">Dominance:</strong>
                    <span class="text-gray-700">Controlled (powerful, in-control) vs. Submissive (weak, powerless)</span>
                </li>
            </ul>
            <p class="text-gray-700 mt-3">
                VAD scores range from 0 to 1, with 0.5 being neutral. These provide a complementary view to
                the categorical emotions.
            </p>
        </div>

        <!-- Step 4 -->
        <div class="border-l-4 border-pink-500 pl-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">4. Emotional Dyads</h3>
            <p class="text-gray-700 mb-3">
                Plutchik's theory describes <strong>18 complex emotions</strong> formed by combining basic emotions:
            </p>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <div class="bg-gray-50 p-2 rounded">
                    <strong class="text-sm">Love</strong>
                    <p class="text-xs text-gray-600">Joy + Trust</p>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <strong class="text-sm">Guilt</strong>
                    <p class="text-xs text-gray-600">Joy + Fear</p>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <strong class="text-sm">Pride</strong>
                    <p class="text-xs text-gray-600">Anger + Joy</p>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <strong class="text-sm">Despair</strong>
                    <p class="text-xs text-gray-600">Fear + Sadness</p>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <strong class="text-sm">Anxiety</strong>
                    <p class="text-xs text-gray-600">Anticipation + Fear</p>
                </div>
                <div class="bg-gray-50 p-2 rounded">
                    <strong class="text-sm">Hope</strong>
                    <p class="text-xs text-gray-600">Anticipation + Trust</p>
                </div>
            </div>
            <p class="text-gray-700 mt-3">
                Dyads are calculated by averaging the scores of their component emotions.
            </p>
        </div>

        <!-- Step 5 -->
        <div class="border-l-4 border-indigo-500 pl-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">5. Narrative Arc Detection</h3>
            <p class="text-gray-700 mb-3">
                We analyze the <strong>emotional intensity trajectory</strong> to identify narrative structure:
            </p>
            <ul class="list-disc list-inside text-gray-600 space-y-1">
                <li><strong>Climax:</strong> Point of highest emotional intensity</li>
                <li><strong>Rising Action:</strong> Buildup before climax</li>
                <li><strong>Resolution:</strong> Decline after climax</li>
                <li><strong>Arc Type:</strong> Classic, In Medias Res, or Slow Burn</li>
            </ul>
        </div>

        <!-- Step 6 -->
        <div class="border-l-4 border-red-500 pl-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">6. Topic Modeling (LDA)</h3>
            <p class="text-gray-700 mb-3">
                <strong>Latent Dirichlet Allocation (LDA)</strong> discovers thematic topics by finding
                co-occurring words:
            </p>
            <ul class="list-disc list-inside text-gray-600 space-y-1">
                <li>Extract 10 latent topics per book</li>
                <li>Each topic is a distribution over words</li>
                <li>We interpret topics by their top keywords</li>
                <li>Used for genre classification alongside emotions</li>
            </ul>
        </div>
    </div>

    <!-- Interpreting Scores -->
    <div class="bg-blue-50 rounded-lg p-8 mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Interpreting the Scores</h2>

        <div class="space-y-4">
            <div>
                <h3 class="font-semibold text-gray-900">Percentile Rankings</h3>
                <p class="text-gray-700">
                    Raw scores are hard to interpret, so we show <strong>percentile rankings</strong>.
                    A 75th percentile joy score means this book is more joyful than 75% of books in the database.
                </p>
            </div>

            <div>
                <h3 class="font-semibold text-gray-900">Comparative Context</h3>
                <p class="text-gray-700">
                    We provide interpretations like "exceptionally uplifting" or "notably fearful" based on
                    how the book compares to others, making the analysis more intuitive.
                </p>
            </div>

            <div>
                <h3 class="font-semibold text-gray-900">Emotional Distance</h3>
                <p class="text-gray-700">
                    Book similarity is calculated using <strong>Euclidean distance</strong> across all 8 emotions.
                    Books with similar emotional profiles will have small distances and appear in recommendations.
                </p>
            </div>
        </div>
    </div>

    <!-- Limitations -->
    <div class="border-2 border-gray-200 rounded-lg p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Limitations & Caveats</h2>
        <ul class="space-y-3 text-gray-700">
            <li class="flex items-start">
                <span class="mr-2">⚠️</span>
                <span><strong>Word-level analysis:</strong> We analyze individual words, not sentences or context.
                Sarcasm, negation, and metaphor may be misinterpreted.</span>
            </li>
            <li class="flex items-start">
                <span class="mr-2">⚠️</span>
                <span><strong>Lexicon coverage:</strong> Not all words are in the emotion lexicons.
                Rare or archaic words may be ignored.</span>
            </li>
            <li class="flex items-start">
                <span class="mr-2">⚠️</span>
                <span><strong>Genre bias:</strong> The NRC lexicon was developed primarily with modern English.
                Results may vary for older texts or different writing styles.</span>
            </li>
            <li class="flex items-start">
                <span class="mr-2">⚠️</span>
                <span><strong>Relative, not absolute:</strong> Scores measure frequency of emotion words,
                not the actual emotional impact on readers.</span>
            </li>
        </ul>
    </div>

    <!-- Call to Action -->
    <div class="text-center mt-12">
        <a href="{% url 'books:home' %}"
           class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700">
            Explore the Library
        </a>
    </div>
</div>
{% endblock %}
